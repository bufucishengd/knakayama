---
- name: Clone git repositories
  git:
    repo: "{{ item.repo }}"
    dest: "{{ item.dest }}"
  with_items:
    - "{{ git_repositories }}"

- name: Setup my git repositories
  shell: |
    rake -t
  args:
    chdir: "{{ item.chdir }}"
    creates: "{{ item.creates }}"
  with_items:
    - "{{ setup_repositories }}"

- name: Install termtile
  shell: |
    ./install.sh yes
  args:
    chdir: "{{ ghq_root }}/apaszke/termtile"
    creates: "{{ ansible_user_dir }}/.termtile/getScreenInfo"

- name: Create symlinks
  file:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    force: yes
    state: link
  with_items:
    - "{{ symlinks }}"

- name: Get latest dbxcli version
  shell: |
    curl -s https://api.github.com/repos/dropbox/dbxcli/tags | grep name | head -n 1 | sed 's/[," ]//g' | cut -d ':' -f 2
  register: dbxcli_version
  always_run: yes
  failed_when: no
  changed_when: no

- name: Install dbxcli
  get_url:
    url: "{{ dbxcli_url }}/{{ dbxcli_version.stdout }}/dbxcli-darwin-amd64"
    dest: /usr/local/bin/dbxcli
    mode: 0755
    force: yes

- name: Install apex
  shell: |
    curl https://raw.githubusercontent.com/apex/apex/master/install.sh | sh
  args:
    creates: /usr/local/bin/apex

- name: Install apex zsh completion
  get_url:
    url: https://gist.githubusercontent.com/knakayama/002e3f5af837df385776/raw/c74f98a81ea0e20f6aee631498caf3d5e489dd87/_apex
    dest: "{{ ansible_user_dir }}/.zsh/completions/_apex"
    force: yes
